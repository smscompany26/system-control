<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>System Control Panel</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:'Cairo',sans-serif; background:#0a0e14; color:#e6edf3; min-height:100vh; }
.bg-mesh { position:fixed; inset:0; z-index:0; pointer-events:none;
  background: radial-gradient(ellipse 600px 400px at 20% 30%, rgba(108,60,233,0.12), transparent),
              radial-gradient(ellipse 500px 350px at 80% 70%, rgba(248,81,73,0.08), transparent); }

.auth-screen { min-height:100vh; display:flex; align-items:center; justify-content:center; position:relative; z-index:1; }
.auth-box { background:rgba(22,27,34,0.9); border:1px solid #30363d; border-radius:16px; padding:40px; max-width:380px; width:90%; text-align:center; }
.auth-box h1 { font-size:22px; margin-bottom:8px; }
.auth-box p { color:#7d8590; font-size:13px; margin-bottom:24px; }
.auth-box input { width:100%; padding:12px 16px; background:#0d1117; border:1px solid #30363d; border-radius:10px; color:#e6edf3; font-size:14px; font-family:inherit; outline:none; margin-bottom:16px; }
.auth-box input:focus { border-color:#6c3ce9; }
.auth-box button { width:100%; padding:12px; background:linear-gradient(135deg,#6c3ce9,#8b5cf6); color:#fff; border:none; border-radius:10px; font-size:14px; font-weight:600; cursor:pointer; font-family:inherit; }
.auth-err { color:#f85149; font-size:12px; margin-top:8px; display:none; }

.container { position:relative; z-index:1; max-width:800px; margin:0 auto; padding:32px 20px; display:none; }
.header { display:flex; align-items:center; justify-content:space-between; margin-bottom:32px; }
.header h1 { font-size:24px; font-weight:800; }
.header .badge { padding:4px 12px; border-radius:20px; font-size:11px; font-weight:600; background:rgba(108,60,233,0.15); color:#8b5cf6; }

.system-card {
  background:rgba(22,27,34,0.8); border:1px solid rgba(48,54,61,0.6);
  border-radius:16px; padding:24px; margin-bottom:20px;
  backdrop-filter:blur(20px);
}
.sys-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; flex-wrap:wrap; gap:12px; }
.sys-name { font-size:18px; font-weight:700; }
.sys-url { font-size:12px; color:#7d8590; direction:ltr; }
.sys-status {
  display:inline-flex; align-items:center; gap:6px;
  padding:6px 14px; border-radius:20px; font-size:12px; font-weight:600;
}
.sys-status.active { background:rgba(63,185,80,0.15); color:#3fb950; }
.sys-status.temp-disabled { background:rgba(210,153,34,0.15); color:#d29922; }
.sys-status.disabled { background:rgba(248,81,73,0.15); color:#f85149; }
.sys-status .dot { width:8px; height:8px; border-radius:50%; }
.sys-status.active .dot { background:#3fb950; }
.sys-status.temp-disabled .dot { background:#d29922; animation:pulse 1.5s infinite; }
.sys-status.disabled .dot { background:#f85149; }
@keyframes pulse { 0%,100%{opacity:1}50%{opacity:0.3} }

.controls { display:flex; flex-direction:column; gap:12px; margin-top:20px; }
.ctrl-row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.btn {
  padding:10px 20px; border-radius:10px; font-size:13px; font-weight:600;
  cursor:pointer; border:none; font-family:'Cairo',sans-serif; transition:all 0.2s;
  flex-shrink:0;
}
.btn:disabled { opacity:0.4; cursor:not-allowed; }
.btn-activate { background:linear-gradient(135deg,#238636,#2ea043); color:#fff; }
.btn-temp { background:linear-gradient(135deg,#9e6a03,#d29922); color:#fff; }
.btn-disable { background:linear-gradient(135deg,#da3633,#f85149); color:#fff; }
.btn-save { padding:8px 16px; background:rgba(108,60,233,0.2); color:#8b5cf6; font-size:12px; }

.time-inputs { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
.time-input {
  width:55px; padding:8px; background:#0d1117; border:1px solid #30363d;
  border-radius:8px; color:#e6edf3; font-size:13px; text-align:center;
  font-family:'Cairo',sans-serif;
}
.time-label { color:#7d8590; font-size:11px; }

.countdown {
  font-family:'JetBrains Mono',monospace; font-size:14px; color:#d29922;
  margin-top:8px; direction:ltr; text-align:center;
  padding:10px; background:rgba(210,153,34,0.08); border-radius:8px;
}

.trial-section {
  margin-top:16px; padding-top:16px; border-top:1px solid rgba(255,255,255,0.08);
}
.trial-header { display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; flex-wrap:wrap; gap:8px; }
.trial-header span { font-size:14px; font-weight:600; }

.log-box {
  background:#000; border:1px solid #21262d; border-radius:12px;
  overflow:hidden; margin-top:24px;
  font-family:'JetBrains Mono',monospace;
}
.log-header { display:flex; align-items:center; gap:6px; padding:10px 14px; background:#1a1a1a; border-bottom:1px solid #21262d; }
.log-dot { width:10px; height:10px; border-radius:50%; }
.log-dot.r { background:#ff5f56; } .log-dot.y { background:#ffbd2e; } .log-dot.g { background:#27c93f; }
.log-title { font-size:11px; color:#666; margin-right:10px; }
.log-body { padding:12px 14px; max-height:220px; overflow-y:auto; direction:ltr; text-align:left; }
.log-line { font-size:11px; line-height:2; color:#8b949e; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.log-line .ts { color:#484f58; } .log-line .act { color:#98c379; } .log-line .warn { color:#e5c07b; } .log-line .err { color:#e06c75; }

.spinner { display:inline-block; width:14px; height:14px; border:2px solid rgba(255,255,255,0.2); border-top-color:#fff; border-radius:50%; animation:spin 0.6s linear infinite; vertical-align:middle; margin-left:6px; }
@keyframes spin { to { transform:rotate(360deg); } }

@media(max-width:640px) {
  .header h1 { font-size:20px; }
  .ctrl-row { flex-direction:column; align-items:stretch; }
  .btn { text-align:center; }
  .time-inputs { justify-content:center; }
}
</style>
</head>
<body>
<div class="bg-mesh"></div>

<div class="auth-screen" id="authScreen">
  <div class="auth-box">
    <div style="font-size:40px;margin-bottom:16px;">ğŸ”</div>
    <h1>System Control</h1>
    <p>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©</p>
    <input type="text" id="authToken" placeholder="GitHub Token" style="direction:ltr;text-align:left;font-family:'JetBrains Mono',monospace;font-size:12px;" autocomplete="off">
    <input type="password" id="authPass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" onkeydown="if(event.key==='Enter')doLogin()">
    <label style="display:flex;align-items:center;gap:8px;color:#7d8590;font-size:13px;margin:12px 0 16px;cursor:pointer;justify-content:center;">
      <input type="checkbox" id="authRemember" style="accent-color:#6c3ce9;width:16px;height:16px;cursor:pointer;">
      <span>ØªØ°ÙƒØ±Ù†ÙŠ Ù„Ù…Ø¯Ø© 30 ÙŠÙˆÙ…</span>
    </label>
    <button onclick="doLogin()">Ø¯Ø®ÙˆÙ„</button>
    <p class="auth-err" id="authErr">ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©</p>
  </div>
</div>

<div class="container" id="mainPanel">
  <div class="header">
    <h1>âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>
    <span id="systemCount" class="badge"></span>
  </div>
  <div id="systemsList"></div>
  <div class="log-box">
    <div class="log-header">
      <div class="log-dot g"></div><div class="log-dot y"></div><div class="log-dot r"></div>
      <span class="log-title">control-panel.log</span>
    </div>
    <div class="log-body" id="logBody"></div>
  </div>
</div>

<script>
const REPO = 'smscompany26/system-control';
const STATUS_FILE = 'status.json';
const PASS_HASH = '967df454b46ab9a2ec8c37dd3f36b6bff9ba6a09786da2aa55a7ea0efe86416a';

let GITHUB_TOKEN = '';
let statusData = null;
let fileSha = null;
let saving = false;
let countdownTimers = {};

// â”€â”€ Helpers â”€â”€
async function sha256(msg) {
  const buf = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(msg));
  return Array.from(new Uint8Array(buf)).map(b => b.toString(16).padStart(2,'0')).join('');
}

function addLog(tag, cls, msg) {
  const body = document.getElementById('logBody');
  if (!body) return;
  const now = new Date().toLocaleTimeString('en-GB', {hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false});
  const div = document.createElement('div');
  div.className = 'log-line';
  div.innerHTML = `<span class="ts">[${now}]</span> <span class="${cls}">${tag}</span> ${msg}`;
  body.appendChild(div);
  body.scrollTop = body.scrollHeight;
  // Keep max 50 lines
  while (body.children.length > 50) body.removeChild(body.firstChild);
}

// â”€â”€ GitHub API â”€â”€
async function ghFetch(path, method='GET', body=null) {
  const opts = {
    method,
    headers: {
      'Accept': 'application/vnd.github.v3+json',
    }
  };
  if (GITHUB_TOKEN) opts.headers['Authorization'] = `token ${GITHUB_TOKEN}`;
  if (body) {
    opts.headers['Content-Type'] = 'application/json';
    opts.body = JSON.stringify(body);
  }
  return fetch(`https://api.github.com/repos/${REPO}/contents/${path}`, opts);
}

async function loadStatus() {
  try {
    const res = await ghFetch(STATUS_FILE);
    if (res.ok) {
      const data = await res.json();
      fileSha = data.sha;
      const raw = atob(data.content.replace(/\n/g, ''));
      statusData = JSON.parse(decodeURIComponent(escape(raw)));
      addLog('LOAD', 'act', `${Object.keys(statusData.systems).length} system(s) loaded`);
      renderSystems();
      return true;
    }
    addLog('ERROR', 'err', `Load failed: ${res.status}`);
    return false;
  } catch(e) {
    addLog('ERROR', 'err', `Load error: ${e.message}`);
    return false;
  }
}

async function saveStatus() {
  if (saving || !fileSha) {
    addLog('WARN', 'warn', saving ? 'Save already in progress' : 'No SHA â€” reload first');
    return false;
  }
  saving = true;
  try {
    const json = JSON.stringify(statusData, null, 2);
    const encoded = btoa(unescape(encodeURIComponent(json)));
    const res = await ghFetch(STATUS_FILE, 'PUT', {
      message: 'Update status â€” ' + new Date().toISOString(),
      content: encoded,
      sha: fileSha
    });
    if (res.ok) {
      const data = await res.json();
      fileSha = data.content.sha;
      addLog('SAVE', 'act', 'âœ“ Saved to GitHub');
      return true;
    }
    // Failed â€” get error details
    let errMsg = `HTTP ${res.status}`;
    try {
      const errData = await res.json();
      errMsg = errData.message || errMsg;
    } catch(e) {}
    addLog('ERROR', 'err', `Save failed: ${errMsg}`);

    // If 409 conflict (SHA mismatch), refresh SHA
    if (res.status === 409 || res.status === 422) {
      addLog('INFO', 'warn', 'Refreshing SHA...');
      try {
        const r2 = await ghFetch(STATUS_FILE);
        if (r2.ok) {
          const d = await r2.json();
          fileSha = d.sha;
          addLog('INFO', 'act', 'SHA refreshed â€” try again');
        }
      } catch(e) {}
    }
    return false;
  } catch(e) {
    addLog('ERROR', 'err', `Save error: ${e.message}`);
    return false;
  } finally {
    saving = false;
  }
}

// â”€â”€ Auth â”€â”€
async function doLogin() {
  const pass = document.getElementById('authPass').value;
  const hash = await sha256(pass);
  if (hash !== PASS_HASH) {
    const err = document.getElementById('authErr');
    err.style.display = 'block';
    setTimeout(() => err.style.display = 'none', 2000);
    return;
  }
  GITHUB_TOKEN = document.getElementById('authToken').value.trim();
  if (!GITHUB_TOKEN) {
    alert('GitHub Token Ù…Ø·Ù„ÙˆØ¨ Ù„Ù„ÙƒØªØ§Ø¨Ø©');
    return;
  }
  const remember = document.getElementById('authRemember').checked;
  sessionStorage.setItem('ctrl_auth', '1');
  sessionStorage.setItem('ctrl_token', GITHUB_TOKEN);
  if (remember) {
    localStorage.setItem('ctrl_auth', '1');
    localStorage.setItem('ctrl_token', GITHUB_TOKEN);
    localStorage.setItem('ctrl_expiry', (Date.now() + 30*86400000).toString());
  }
  showPanel();
}

function checkSavedAuth() {
  let token = '';
  if (sessionStorage.getItem('ctrl_auth') === '1') {
    token = sessionStorage.getItem('ctrl_token') || '';
  } else {
    const expiry = parseInt(localStorage.getItem('ctrl_expiry') || '0');
    if (localStorage.getItem('ctrl_auth') === '1' && Date.now() < expiry) {
      token = localStorage.getItem('ctrl_token') || '';
    }
  }
  // No token = force re-login (clear stale sessions)
  if (!token || token.length < 10) {
    sessionStorage.clear();
    localStorage.removeItem('ctrl_auth');
    localStorage.removeItem('ctrl_token');
    localStorage.removeItem('ctrl_expiry');
    return false;
  }
  GITHUB_TOKEN = token;
  sessionStorage.setItem('ctrl_auth', '1');
  sessionStorage.setItem('ctrl_token', GITHUB_TOKEN);
  return true;
}

function showPanel() {
  document.getElementById('authScreen').style.display = 'none';
  document.getElementById('mainPanel').style.display = 'block';
  addLog('AUTH', 'act', 'Logged in');
  loadStatus();
}

// â”€â”€ Render â”€â”€
function renderSystems() {
  const list = document.getElementById('systemsList');
  if (!statusData || !statusData.systems) {
    list.innerHTML = '<div style="text-align:center;padding:40px;color:#7d8590;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù†Ø¸Ù…Ø©</div>';
    return;
  }
  const systems = statusData.systems;
  const keys = Object.keys(systems);
  document.getElementById('systemCount').textContent = keys.length + ' Ù†Ø¸Ø§Ù…';

  // Check expired temp-disables (queue save, don't call inside render)
  let needsSave = false;
  keys.forEach(key => {
    const sys = systems[key];
    if (sys.status === 'temp-disabled' && sys.disableUntil && new Date(sys.disableUntil) <= new Date()) {
      sys.status = 'active';
      sys.disableType = null;
      sys.disableUntil = null;
      needsSave = true;
    }
  });
  if (needsSave) setTimeout(() => saveStatus(), 100);

  list.innerHTML = keys.map(key => {
    const sys = systems[key];
    const sc = sys.status === 'active' ? 'active' : sys.status === 'temp-disabled' ? 'temp-disabled' : 'disabled';
    const st = sys.status === 'active' ? 'Ù…ÙØ¹Ù‘Ù„' : sys.status === 'temp-disabled' ? 'Ù…Ø¹Ø·Ù‘Ù„ Ù…Ø¤Ù‚ØªØ§Ù‹' : 'Ù…Ø¹Ø·Ù‘Ù„';
    const trial = sys.trial || null;

    return `
      <div class="system-card">
        <div class="sys-header">
          <div>
            <div class="sys-name">${esc(sys.name)}</div>
            <div class="sys-url">${esc(sys.url)}</div>
          </div>
          <div class="sys-status ${sc}"><span class="dot"></span>${st}</div>
        </div>

        ${sys.status === 'temp-disabled' && sys.disableUntil ? `<div class="countdown" id="cd-${key}"></div>` : ''}

        <div class="controls">
          <div class="ctrl-row">
            <button class="btn btn-activate" onclick="doAction('activate','${key}')" ${sys.status==='active'?'disabled':''}>âœ… ØªÙØ¹ÙŠÙ„</button>
            <button class="btn btn-disable" onclick="doAction('disable','${key}')" ${sys.status==='disabled'?'disabled':''}>ğŸš« ØªØ¹Ø·ÙŠÙ„ Ø¯Ø§Ø¦Ù…</button>
          </div>
          <div class="ctrl-row">
            <button class="btn btn-temp" onclick="doAction('temp','${key}')">â± ØªØ¹Ø·ÙŠÙ„ Ù…Ø¤Ù‚Øª</button>
            <div class="time-inputs">
              <input type="number" class="time-input" id="days-${key}" value="0" min="0"><span class="time-label">ÙŠÙˆÙ…</span>
              <input type="number" class="time-input" id="hours-${key}" value="0" min="0"><span class="time-label">Ø³Ø§Ø¹Ø©</span>
              <input type="number" class="time-input" id="mins-${key}" value="0" min="0"><span class="time-label">Ø¯Ù‚ÙŠÙ‚Ø©</span>
            </div>
          </div>

          ${trial ? `
          <div class="trial-section">
            <div class="trial-header">
              <span>â° Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©</span>
              <label style="display:flex;align-items:center;gap:6px;cursor:pointer;font-size:12px;color:#7d8590;">
                <input type="checkbox" id="trial-on-${key}" ${trial.enabled?'checked':''} style="accent-color:#6c3ce9;width:16px;height:16px;">
                ${trial.enabled ? 'Ù…ÙØ¹Ù‘Ù„Ø©' : 'Ù…Ø¹Ø·Ù‘Ù„Ø©'}
              </label>
            </div>
            <div class="ctrl-row" style="gap:8px;">
              <label style="font-size:12px;color:#7d8590;flex-shrink:0;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</label>
              <input type="datetime-local" id="trial-date-${key}" value="${(trial.endDate||'').slice(0,16)}" style="padding:8px;background:#0d1117;border:1px solid #30363d;border-radius:8px;color:#e6edf3;font-size:12px;font-family:inherit;flex:1;min-width:0;">
              <button class="btn btn-save" onclick="doAction('trial-date','${key}')">Ø­ÙØ¸</button>
            </div>
            <div class="ctrl-row" style="margin-top:8px;gap:8px;">
              <label style="font-size:12px;color:#7d8590;flex-shrink:0;">ØªØ­Ø°ÙŠØ± Ù‚Ø¨Ù„ (Ø£ÙŠØ§Ù…):</label>
              <input type="number" class="time-input" id="trial-warn-${key}" value="${trial.warnDays||3}" min="1" max="30" style="width:55px;">
              <button class="btn btn-save" onclick="doAction('trial-warn','${key}')">Ø­ÙØ¸</button>
            </div>
          </div>
          ` : ''}
        </div>
      </div>`;
  }).join('');

  // Bind trial checkbox (no onchange in HTML to avoid render loops)
  keys.forEach(key => {
    const cb = document.getElementById(`trial-on-${key}`);
    if (cb) cb.onchange = () => doAction('trial-toggle', key);
  });

  // Start countdowns
  keys.forEach(key => {
    const sys = systems[key];
    if (sys.status === 'temp-disabled' && sys.disableUntil) {
      startCountdown(key, new Date(sys.disableUntil));
    }
  });
}

function esc(s) { const d = document.createElement('div'); d.textContent = s; return d.innerHTML; }

// â”€â”€ Actions (unified) â”€â”€
async function doAction(action, key) {
  const sys = statusData.systems[key];
  if (!sys) return;

  switch(action) {
    case 'activate':
      sys.status = 'active';
      sys.disableType = null;
      sys.disableUntil = null;
      sys.disabledAt = null;
      break;

    case 'disable':
      if (!confirm(`ØªØ¹Ø·ÙŠÙ„ "${sys.name}" Ø¨Ø´ÙƒÙ„ Ø¯Ø§Ø¦Ù…ØŸ`)) return;
      sys.status = 'disabled';
      sys.disableType = 'permanent';
      sys.disableUntil = null;
      sys.disabledAt = new Date().toISOString();
      sys.disabledBy = 'Kyrolos';
      break;

    case 'temp': {
      const d = parseInt(document.getElementById(`days-${key}`).value) || 0;
      const h = parseInt(document.getElementById(`hours-${key}`).value) || 0;
      const m = parseInt(document.getElementById(`mins-${key}`).value) || 0;
      const totalMs = d*86400000 + h*3600000 + m*60000;
      if (totalMs <= 0) { alert('Ø­Ø¯Ø¯ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ø£ÙˆÙ„'); return; }
      const until = new Date(Date.now() + totalMs);
      sys.status = 'temp-disabled';
      sys.disableType = 'temporary';
      sys.disableUntil = until.toISOString();
      sys.disabledAt = new Date().toISOString();
      break;
    }

    case 'trial-toggle': {
      const cb = document.getElementById(`trial-on-${key}`);
      if (!sys.trial) sys.trial = {};
      sys.trial.enabled = cb.checked;
      break;
    }

    case 'trial-date': {
      const val = document.getElementById(`trial-date-${key}`).value;
      if (!val) { alert('Ø­Ø¯Ø¯ Ø§Ù„ØªØ§Ø±ÙŠØ®'); return; }
      if (!sys.trial) sys.trial = {};
      sys.trial.endDate = new Date(val).toISOString();
      break;
    }

    case 'trial-warn': {
      const val = parseInt(document.getElementById(`trial-warn-${key}`).value) || 3;
      if (!sys.trial) sys.trial = {};
      sys.trial.warnDays = val;
      break;
    }
  }

  addLog('ACTION', 'warn', `${action} â†’ ${sys.name}...`);
  const ok = await saveStatus();
  if (ok) {
    renderSystems();
    const labels = {
      activate: 'âœ… Ù…ÙØ¹Ù‘Ù„', disable: 'ğŸš« Ù…Ø¹Ø·Ù‘Ù„ Ø¯Ø§Ø¦Ù…', temp: 'â± Ù…Ø¹Ø·Ù‘Ù„ Ù…Ø¤Ù‚Øª',
      'trial-toggle': 'â° Trial toggled', 'trial-date': 'ğŸ“… Trial date updated', 'trial-warn': 'âš ï¸ Warn days updated'
    };
    addLog('DONE', 'act', labels[action] || action);
  } else {
    addLog('FAIL', 'err', `Action "${action}" failed â€” check token`);
    // Reload to restore correct state
    await loadStatus();
  }
}

// â”€â”€ Countdown â”€â”€
function startCountdown(key, until) {
  if (countdownTimers[key]) clearInterval(countdownTimers[key]);
  function update() {
    const el = document.getElementById(`cd-${key}`);
    if (!el) { clearInterval(countdownTimers[key]); return; }
    const diff = until - Date.now();
    if (diff <= 0) {
      el.textContent = 'Ø§Ù†ØªÙ‡Øª ÙØªØ±Ø© Ø§Ù„ØªØ¹Ø·ÙŠÙ„ â€” Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙØ¹ÙŠÙ„...';
      clearInterval(countdownTimers[key]);
      doAction('activate', key);
      return;
    }
    const d = Math.floor(diff/86400000);
    const h = Math.floor((diff%86400000)/3600000);
    const m = Math.floor((diff%3600000)/60000);
    const s = Math.floor((diff%60000)/1000);
    el.textContent = `â± Ù…ØªØ¨Ù‚ÙŠ: ${d}d ${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }
  update();
  countdownTimers[key] = setInterval(update, 1000);
}

// â”€â”€ Init â”€â”€
if (checkSavedAuth()) {
  showPanel();
} else {
  addLog('INFO', 'warn', 'Waiting for login...');
}

// Auto-refresh every 60s
setInterval(() => { if (statusData && !saving) loadStatus(); }, 60000);
</script>
</body>
</html>
